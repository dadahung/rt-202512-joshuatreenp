<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Joshua Tree 12/28 — 12/30</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Google Font: Noto Sans & Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Noto+Sans+JP:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --muji-bg: #fdfcfb;
            --muji-card-bg: #ffffff;
            --muji-text: #333333;
            --muji-text-light: #757575;
            --muji-border: #e6e6e6;
            --muji-red: #8b0000; /* Signature Muji Crimson */
            --muji-earth: #7f5539;
        }
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: var(--muji-bg);
            color: var(--muji-text);
            -webkit-tap-highlight-color: transparent;
        }
        .muji-card {
            background: var(--muji-card-bg);
            border: 1px solid var(--muji-border);
            border-radius: 2px;
            transition: transform 0.1s ease;
        }
        .muji-btn-primary {
            background-color: var(--muji-text);
            color: white;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            letter-spacing: 0.05em;
            border-radius: 2px;
        }
        .muji-btn-outline {
            border: 1px solid var(--muji-border);
            background: white;
            color: var(--muji-text);
            padding: 0.5rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 2px;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 0.75rem 0;
            color: #b0b0b0;
            font-size: 0.65rem;
            font-weight: 500;
            transition: color 0.2s;
        }
        .nav-item.active { color: var(--muji-red); }
        .nav-item i { font-size: 1.25rem; display: block; margin-bottom: 4px; }

        /* Timeline */
        .timeline-line {
            position: absolute;
            left: 19px;
            top: 0;
            bottom: 0;
            width: 1px;
            background-color: var(--muji-border);
        }
        .timeline-dot {
            position: absolute;
            left: 15px;
            width: 9px;
            height: 9px;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--muji-earth);
            z-index: 10;
        }
        .timeline-dot.important {
            border-color: var(--muji-red);
            background: var(--muji-red);
        }

        /* Typography */
        h1, h2, h3 { letter-spacing: 0.1em; text-transform: uppercase; }
        .magazine-dropcap::first-letter {
            float: left;
            font-size: 3rem;
            line-height: 1;
            padding-right: 8px;
            color: var(--muji-earth);
            font-weight: 300;
        }
        
        /* Smooth View Switching */
        .view { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="pb-24 antialiased">

    <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col">
        <!-- Persistent Header -->
        <header class="pt-10 pb-6 px-6 text-center border-b border-gray-100 mb-6 sticky top-0 bg-white/80 backdrop-blur-md z-40">
            <h1 class="text-xl font-light">Joshua Tree</h1>
            <p class="text-[10px] text-gray-400 mt-1 uppercase tracking-[0.2em]">12.28 — 12.30 • 2024 Road Trip</p>
        </header>

        <!-- View: ITINERARY -->
        <section id="view-itinerary" class="view px-6">
            <div class="flex gap-4 mb-8">
                <button onclick="switchTab('itinerary', 'daily')" id="tab-daily" class="flex-1 pb-2 text-xs font-bold border-b-2 border-black">ITINERARY</button>
                <button onclick="switchTab('itinerary', 'all')" id="tab-all" class="flex-1 pb-2 text-xs font-bold border-b-2 border-transparent text-gray-300">ALL ATTRACTION</button>
            </div>
            
            <div id="itinerary-content" class="relative">
                <!-- Content injected via JS -->
            </div>
        </section>

        <!-- View: GUIDE -->
        <section id="view-guide" class="view px-6 hidden space-y-12">
            <!-- Content injected via JS -->
        </section>

        <!-- View: WALLET -->
        <section id="view-wallet" class="view px-6 hidden">
            <div class="muji-card p-5 mb-8">
                <h2 class="text-xs font-bold mb-4">Add Expense</h2>
                <div class="space-y-3">
                    <input type="text" id="wallet-desc" placeholder="Item Description" class="w-full border-b border-gray-200 py-2 text-sm focus:outline-none focus:border-black">
                    <input type="number" id="wallet-amt" placeholder="Amount (USD)" class="w-full border-b border-gray-200 py-2 text-sm focus:outline-none focus:border-black">
                    <div class="flex items-center justify-between py-2">
                        <label class="cursor-pointer text-[10px] uppercase font-bold text-gray-400 hover:text-black">
                            <i class="fas fa-camera mr-2"></i> <span id="photo-label">Attach Receipt</span>
                            <input type="file" id="wallet-photo" accept="image/*" class="hidden" onchange="handlePhotoSelect(this)">
                        </label>
                        <button onclick="saveExpense()" class="muji-btn-primary px-6 py-2 text-xs">Save</button>
                    </div>
                </div>
            </div>

            <div id="wallet-list" class="space-y-4"></div>
            
            <div class="mt-8 pt-4 border-t border-gray-200 flex justify-between items-end">
                <span class="text-[10px] text-gray-400 uppercase font-bold">Total Estimated</span>
                <span id="wallet-total" class="text-2xl font-light">$0.00</span>
            </div>
        </section>

        <!-- View: LISTS -->
        <section id="view-lists" class="view px-6 hidden">
            <div class="mb-12">
                <h2 class="text-xs font-bold mb-6 border-b pb-2">PRE-TRIP CHECKLIST</h2>
                <div id="checklist-items" class="space-y-4"></div>
            </div>

            <div>
                <h2 class="text-xs font-bold mb-6 border-b pb-2">PERSONAL NOTES</h2>
                <textarea id="note-input" placeholder="Type notes or paste links here..." class="w-full h-32 p-4 text-sm border border-gray-100 bg-gray-50/50 rounded-sm focus:outline-none focus:bg-white mb-3"></textarea>
                <button onclick="addNote()" class="muji-btn-primary w-full text-xs py-3">Add Entry</button>
                <div id="notes-list" class="mt-6 space-y-4"></div>
            </div>
        </section>

        <!-- View: INFO -->
        <section id="view-info" class="view px-6 hidden space-y-10">
            <div>
                <h2 class="text-xs font-bold mb-4">Emergency</h2>
                <div class="muji-card p-4 text-sm divide-y divide-gray-50">
                    <div class="flex justify-between py-3"><span>General Emergency</span><span class="font-bold text-red-800">911</span></div>
                    <div class="flex justify-between py-3"><span>Park Ranger</span><span>760-367-5500</span></div>
                    <div class="flex justify-between py-3"><span>San Bernardino Sheriff</span><span>909-387-8313</span></div>
                </div>
            </div>

            <div>
                <h2 class="text-xs font-bold mb-4">Accommodation</h2>
                <div class="muji-card p-4 text-sm">
                    <p class="font-medium text-red-900">Joshua Tree Rental</p>
                    <p class="text-gray-500 mt-1">4949 1st Street East<br>Joshua Tree, CA 92252</p>
                    <a href="https://www.google.com/maps/search/?api=1&query=4949+1st+Street+East+Joshua+Tree+CA+92252" target="_blank" class="mt-4 block text-center border border-gray-200 py-2 text-xs text-gray-400">View on Map</a>
                </div>
            </div>

            <div>
                <h2 class="text-xs font-bold mb-4">Resources</h2>
                <a href="https://forecast.weather.gov/MapClick.php?lat=34.1281&lon=-116.3114" target="_blank" class="muji-card p-4 mb-3 flex items-center justify-between">
                    <span class="text-sm">Official Weather Forecast</span>
                    <i class="fas fa-external-link-alt text-gray-300 text-xs"></i>
                </a>
                <a href="https://www.nps.gov/jotr/index.htm" target="_blank" class="muji-card p-4 flex items-center justify-between">
                    <span class="text-sm">NPS Visitor Information</span>
                    <i class="fas fa-external-link-alt text-gray-300 text-xs"></i>
                </a>
            </div>
        </section>
    </div>

    <!-- Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 flex px-2 z-50 max-w-md mx-auto">
        <div onclick="showView('itinerary')" class="nav-item active" id="nav-itinerary"><i class="fas fa-map-location-dot"></i>PLAN</div>
        <div onclick="showView('guide')" class="nav-item" id="nav-guide"><i class="fas fa-book-open"></i>GUIDE</div>
        <div onclick="showView('wallet')" class="nav-item" id="nav-wallet"><i class="fas fa-wallet"></i>WALLET</div>
        <div onclick="showView('lists')" class="nav-item" id="nav-lists"><i class="fas fa-list-check"></i>LISTS</div>
        <div onclick="showView('info')" class="nav-item" id="nav-info"><i class="fas fa-circle-info"></i>INFO</div>
    </nav>

    <canvas id="canvas-processor" class="hidden"></canvas>

    <script>
        // --- Data Definitions ---
        const DATA = {
            itinerary: [
                { day: 1, date: "Sat, 12/28", items: [
                    { time: "09:00", title: "Depart Irvine", loc: "Irvine, CA", type: "travel", important: true, note: "Start driving around 9am. Head east towards the desert." },
                    { time: "11:30", title: "Joshua Tree West Entrance", loc: "Visitor Center", type: "attraction", note: "Pickup maps and check for park alerts. Purchase entry pass if needed." },
                    { time: "13:30", title: "Hidden Valley", loc: "1mi Nature Loop", type: "attraction", note: "Easy 1-mile loop trail through massive rock formations. Perfect introduction to the landscape." },
                    { time: "14:30", title: "Barker Dam", loc: "1.1mi Loop", type: "attraction", note: "Historical dam site. Easy flat loop, great for spotting bighorn sheep." },
                    { time: "16:00", title: "Keys View", loc: "Sunset Point", type: "attraction", note: "Panoramic views of Coachella Valley and San Andreas Fault. High altitude, might be windy." },
                    { time: "17:00", title: "Rental Check-in", loc: "4949 1st St East", type: "travel", important: true, note: "Arrive at the accommodation to settle in for the night." }
                ]},
                { day: 2, date: "Sun, 12/29", items: [
                    { time: "09:00", title: "Skull Rock", loc: "Roadside Stop", type: "attraction", note: "Famous rock formation right by the road. Quick and easy photo opportunity." },
                    { time: "10:00", title: "Cholla Cactus Garden", loc: "Nature Trail", type: "attraction", note: "0.25-mile walk through a dense field of cacti. Do not touch—they 'jump'!" },
                    { time: "11:30", title: "Arch Rock", loc: "Trailhead", type: "attraction", note: "0.5-mile easy trail to a stunning natural arch formation." },
                    { time: "14:00", title: "Cottonwood Spring", loc: "Palm Oasis", type: "attraction", note: "A lush fan palm oasis in the Colorado Desert section of the park." }
                ]},
                { day: 3, date: "Mon, 12/30", items: [
                    { time: "08:30", title: "Checkout", loc: "Joshua Tree", type: "travel", important: true, note: "Pack up and head south towards Palm Desert." },
                    { time: "09:30", title: "The Living Desert Zoo", loc: "Palm Desert", type: "attraction", note: "Explore desert conservation and see giraffes, cheetahs, and desert plants." },
                    { time: "13:30", title: "Palm Canyons", loc: "Indian Canyons", type: "attraction", note: "Visit the world's largest oasis of California fan palms. Easy walking trails available." },
                    { time: "15:30", title: "Return to Irvine", loc: "Irvine, CA", type: "travel", note: "Heading home. Approx 2 to 2.5 hour drive depending on traffic." }
                ]}
            ],
            guides: [
                { title: "Hidden Valley", desc: "A legendary rock-enclosed valley once rumored to be used by cattle rustlers to hide their herds. The 1-mile nature loop is one of the most popular trails because it features all of Joshua Tree's highlights: massive monzogranite boulders, namesake trees, and desert scrub. It is remarkably flat and easy for all ages." },
                { title: "Barker Dam", desc: "Built by C.O. Barker around 1900, this dam was vital for the survival of cattle in the high desert. Today, the reservoir is a crucial watering hole for local wildlife, particularly desert bighorn sheep. The trail includes examples of Native American petroglyphs (though some were unfortunately enhanced by Hollywood film crews in the past)." },
                { title: "Cholla Cactus Garden", desc: "Located at the transition zone between the higher Mojave Desert and the lower Colorado Desert, this garden features the 'Teddy Bear' Cholla. Despite their cuddly name, their barbs are notoriously painful. They reproduce by shedding 'joints' that attach to passing animals (or hikers), earning them the name 'jumping cactus'." },
                { title: "The Living Desert", desc: "Located in Palm Desert, this 1,200-acre facility is a zoo and botanical garden dedicated to the deserts of the world. It’s highly rated for its conservation efforts and naturalistic habitats. It provides a structured and educational contrast to the wild exploration inside the National Park." },
                { title: "Palm Canyons", desc: "Part of the Agua Caliente Band of Cahuilla Indians' ancestral land, Palm Canyon is home to the world’s largest grove of California Fan Palms (Washingtonia filifera). The contrast between the stark desert walls and the lush green canopy of the oasis floor is breathtaking. The first section of the trail is paved and very accessible." },
                { title: "Keys View", desc: "This is the highest point in the park that you can drive to. On exceptionally clear days, the view stretches past the Salton Sea and Indio all the way to Signal Mountain in Mexico. It provides a literal bird's-eye view of the San Andreas Fault running through the valley below." }
            ],
            checklist: ["Powerbank", "Charger", "USB Cable", "4-days worth of clothes", "Sunscreen", "Water (1gal/person)", "Physical Map", "Park Pass / ID"]
        };

        // --- State Management ---
        let state = {
            view: 'itinerary',
            subTab: 'daily',
            expenses: JSON.parse(localStorage.getItem('jt_expenses') || '[]'),
            notes: JSON.parse(localStorage.getItem('jt_notes') || '[]'),
            checks: JSON.parse(localStorage.getItem('jt_checks') || '{}'),
            pendingPhoto: null
        };

        // --- View Controller ---
        function showView(v) {
            state.view = v;
            document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${v}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${v}`).classList.add('active');
            window.scrollTo(0, 0);
        }

        function switchTab(view, sub) {
            state.subTab = sub;
            const isDaily = sub === 'daily';
            document.getElementById('tab-daily').className = `flex-1 pb-2 text-xs font-bold border-b-2 ${isDaily ? 'border-black' : 'border-transparent text-gray-300'}`;
            document.getElementById('tab-all').className = `flex-1 pb-2 text-xs font-bold border-b-2 ${!isDaily ? 'border-black' : 'border-transparent text-gray-300'}`;
            renderItinerary();
        }

        // --- Renderers ---
        function renderItinerary() {
            const container = document.getElementById('itinerary-content');
            let html = '';

            if (state.subTab === 'daily') {
                DATA.itinerary.forEach(day => {
                    html += `<div class="mb-10 relative">
                        <div class="timeline-line"></div>
                        <h3 class="text-[10px] font-bold text-gray-400 mb-6 bg-white relative z-10 inline-block pr-4 tracking-widest">DAY ${day.day} • ${day.date}</h3>`;
                    
                    day.items.forEach(item => {
                        const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.title + ' ' + item.loc)}`;
                        const driveUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(item.title + ' ' + item.loc)}`;
                        
                        html += `
                        <div class="relative pl-10 mb-6 group">
                            <div class="timeline-dot ${item.important ? 'important' : ''}" style="top: 6px;"></div>
                            <div class="text-[10px] text-gray-400 mb-1 font-medium">${item.time}</div>
                            <div class="muji-card p-4">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="text-sm font-semibold ${item.important ? 'text-red-900' : 'text-gray-800'}">${item.title}</h4>
                                        <p class="text-[10px] text-gray-400 mt-0.5">${item.loc}</p>
                                    </div>
                                    ${item.type === 'attraction' ? '<i class="fas fa-camera text-gray-200 text-xs"></i>' : ''}
                                </div>
                                <p class="text-[11px] text-gray-500 mt-2 leading-relaxed">${item.note || ''}</p>
                                <div class="flex gap-2 mt-4">
                                    <a href="${mapsUrl}" target="_blank" class="muji-btn-outline flex-1 text-center">Open Maps</a>
                                    <a href="${driveUrl}" target="_blank" class="muji-btn-outline flex-1 text-center bg-gray-50">Start Driving</a>
                                </div>
                            </div>
                        </div>`;
                    });
                    html += `</div>`;
                });
            } else {
                const all = [];
                DATA.itinerary.forEach(d => d.items.forEach(i => { if(i.type==='attraction') all.push(i) }));
                all.sort((a,b) => a.title.localeCompare(b.title));
                
                html = `<div class="grid grid-cols-1 gap-3">`;
                all.forEach(item => {
                    html += `
                    <div class="muji-card p-4 flex justify-between items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-800">${item.title}</p>
                            <p class="text-[9px] text-gray-400 uppercase tracking-tighter">${item.loc}</p>
                        </div>
                        <div class="flex gap-2">
                            <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.title)}" target="_blank" class="w-8 h-8 flex items-center justify-center border border-gray-100 rounded text-gray-400"><i class="fas fa-location-dot text-xs"></i></a>
                        </div>
                    </div>`;
                });
                html += `</div>`;
            }
            container.innerHTML = html;
        }

        function renderGuides() {
            const container = document.getElementById('view-guide');
            container.innerHTML = DATA.guides.map(g => `
                <article class="magazine-entry">
                    <h2 class="text-lg font-light border-b border-gray-100 pb-2 mb-4 text-gray-800">${g.title}</h2>
                    <p class="text-sm text-gray-600 leading-relaxed magazine-dropcap">${g.desc}</p>
                    <div class="mt-6 flex items-center text-[9px] uppercase tracking-widest text-gray-400 font-bold">
                        <span class="w-8 h-px bg-gray-200 mr-2"></span> Field Guide Entry 
                    </div>
                </article>
            `).join('');
        }

        // --- Wallet Logic ---
        function handlePhotoSelect(input) {
            const file = input.files[0];
            if (!file) return;
            document.getElementById('photo-label').innerText = "Processing...";
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.getElementById('canvas-processor');
                    const ctx = canvas.getContext('2d');
                    const maxW = 200;
                    const scale = maxW / img.width;
                    canvas.width = maxW;
                    canvas.height = img.height * scale;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    state.pendingPhoto = canvas.toDataURL('image/jpeg', 0.6);
                    document.getElementById('photo-label').innerText = "Photo Ready";
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function saveExpense() {
            const desc = document.getElementById('wallet-desc').value;
            const amt = document.getElementById('wallet-amt').value;
            if (!desc || !amt) return;

            state.expenses.push({
                id: Date.now(),
                desc,
                amt: parseFloat(amt),
                photo: state.pendingPhoto
            });

            localStorage.setItem('jt_expenses', JSON.stringify(state.expenses));
            renderWallet();
            
            document.getElementById('wallet-desc').value = '';
            document.getElementById('wallet-amt').value = '';
            document.getElementById('wallet-photo').value = '';
            document.getElementById('photo-label').innerText = "Attach Receipt";
            state.pendingPhoto = null;
        }

        function renderWallet() {
            const list = document.getElementById('wallet-list');
            let total = 0;
            list.innerHTML = state.expenses.length ? state.expenses.map(e => {
                total += e.amt;
                return `
                <div class="muji-card p-3 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        ${e.photo ? `<img src="${e.photo}" class="w-10 h-10 object-cover rounded-sm">` : `<div class="w-10 h-10 bg-gray-50 flex items-center justify-center text-gray-200 text-xs"><i class="fas fa-receipt"></i></div>`}
                        <div>
                            <p class="text-xs font-medium text-gray-800">${e.desc}</p>
                            <p class="text-[10px] text-gray-400 font-mono">$${e.amt.toFixed(2)}</p>
                        </div>
                    </div>
                    <button onclick="deleteExpense(${e.id})" class="text-gray-200 hover:text-red-800 p-2 transition-colors"><i class="fas fa-times"></i></button>
                </div>`;
            }).reverse().join('') : `<div class="text-center py-10 text-gray-300 text-xs italic">No expenses recorded.</div>`;
            document.getElementById('wallet-total').innerText = `$${total.toFixed(2)}`;
        }

        function deleteExpense(id) {
            state.expenses = state.expenses.filter(e => e.id !== id);
            localStorage.setItem('jt_expenses', JSON.stringify(state.expenses));
            renderWallet();
        }

        // --- Lists Logic ---
        function renderLists() {
            const checkContainer = document.getElementById('checklist-items');
            checkContainer.innerHTML = DATA.checklist.map(item => `
                <div class="flex items-center gap-3 cursor-pointer group" onclick="toggleCheck('${item}')">
                    <i class="${state.checks[item] ? 'fas fa-check-square text-black' : 'far fa-square text-gray-300'} text-lg group-hover:text-black transition-colors"></i>
                    <span class="text-sm ${state.checks[item] ? 'line-through text-gray-400' : 'text-gray-700'}">${item}</span>
                </div>
            `).join('');

            const notesContainer = document.getElementById('notes-list');
            notesContainer.innerHTML = state.notes.map(n => {
                const urlRegex = /(https?:\/\/[^\s]+)/g;
                const html = n.text.replace(urlRegex, url => `<a href="${url}" target="_blank" class="inline-block bg-black text-white text-[9px] px-2 py-1 rounded mt-2 uppercase tracking-widest font-bold">Open Link</a>`);
                return `
                <div class="muji-card p-4 text-xs leading-relaxed relative group bg-gray-50/30">
                    <div class="whitespace-pre-wrap text-gray-600">${html}</div>
                    <button onclick="deleteNote(${n.id})" class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 text-gray-300 hover:text-red-800 transition-all"><i class="fas fa-trash text-[10px]"></i></button>
                </div>`;
            }).join('');
        }

        function toggleCheck(item) {
            state.checks[item] = !state.checks[item];
            localStorage.setItem('jt_checks', JSON.stringify(state.checks));
            renderLists();
        }

        function addNote() {
            const input = document.getElementById('note-input');
            if (!input.value.trim()) return;
            state.notes.unshift({ id: Date.now(), text: input.value });
            localStorage.setItem('jt_notes', JSON.stringify(state.notes));
            input.value = '';
            renderLists();
        }

        function deleteNote(id) {
            state.notes = state.notes.filter(n => n.id !== id);
            localStorage.setItem('jt_notes', JSON.stringify(state.notes));
            renderLists();
        }

        // --- Initial Load ---
        window.onload = () => {
            renderItinerary();
            renderGuides();
            renderWallet();
            renderLists();
        };
    </script>
</body>
</html>
